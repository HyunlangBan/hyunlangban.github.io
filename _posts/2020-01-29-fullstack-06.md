---
layout: post
tag: fullstack
title: Flask
---

## Install
미국은 거의 맥을 사용해서 그런지 설치도 맥 버전으로만 설명해서 그냥 따라하다가 오류가 나서 또 한참 헤맸다.
일단 Flask와 Falsk-SQLAlchemy를 설치한 후 코드를 작성하고 run을 하려니 FLASK_APP을 실행할 수 없다고 나왔다.
그래서 확인해보니 윈도우에서는 실행시키는 명령어가 달랐다 . cmd에서 할 때와 PowerShell에서 할 때도 다르게 작성해야 하는데
내 컴퓨터에서는 뭐가 꼬였는지 cmd로 할때는 계속 실행이 안되었다(**update** ==> 안되었던 이유: `FLASK_APP = app.py`처럼 등호 양 옆에 공백이 있어서는 안된다!!!!! `FLASK_APP=app.py`로 작성되어야 함). 그래서 PowerShell로 들어가서 했더니 된다.

#### 사용한 코드
```
$env:FLASK_APP = "flask-hello-app.py"
flask run
```

++ [Command Line Interface of Flask](https://flask.palletsprojects.com/en/1.1.x/cli/)

위의 코드를 실행시키면
`Running on http://127.0.0.1:5000/`과 같이 development server가 생기는데 이는 `http://IP주소:포트넘버/`이다. 왜냐하면 웹 서버도 우리의 로컬 머신 안에 있고 우리의 로컬 머신에서 연결을 허용할 것이기 때문이다. shrotcut은 `localhost:5000`

## Hello App with Flask-SQLAlchemy - Part 1

```python
# flask-hello-app.py

from flask import Flask

app = Flask(__name__)     ## flask application을 만드는 가장 기본적인 방법

## 홈페이지에 가서 내가 쓴 Hello World를 출력하고자 한다.
@app.route('/')  # 연결을 위한 homepage route
def index():     # route handler, Index is a standard name for the route handler that listens for connections to the root route and figures out what do next.
  return 'Hello World!'
```

@app.route is a Python [decorator](http://schoolofweb.net/blog/posts/%ED%8C%8C%EC%9D%B4%EC%8D%AC-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-decorator/). Decorators take functions and returns another function, usually extending the input function with additional("decorated") funcionality. @app.route is a decorator that takes an input function `index()` as the callback that gets [invoked](https://stackoverflow.com/questions/18505422/whats-the-difference-between-call-and-invoke) when a request to route `/` comes from a client.

`@app.route('/')`을 처음 봐서 이해가 잘 안갔었는데 찾아보고 내가 이해한 바로는, localhost:5000 + 괄호 안에 있는 문자열이 url이 되고 해당 url에서(url을 방문하면) index()가 리턴한 결과를 보여준다.


#### Alternative approach to run a Flask app: using `__main__`
```python
if __name__ == '__main__':
   app.run()
```
`app.py` 스크립트 하단에 위와 같은 메소드를 정의하면 방금전에 사용한 실행코드를 이용하지 않아도 된다. 그냥 `app.py`를 실행하면 `app.run()`을 호출하고 flask app도 실행된다.
우리가 스크립트를 실행하면 파이썬 인터프리터에 의해 스크립트의 `__name__`은 `__main__`으로 설정이되고 스크립트의 모든 코드를 실행한다. 그리고 끝에 다다라서 `if __name__ == 'main'`을 찾으면 이것을 `True`로 판단하고 `app.run()`을 호출하여 Flask app이 실행된다.

개인적으로 첫번째 방법으로 실행할 때는 운영체제에 따라 코드가 달라져서 헤매었던 반면 이 방법은 상대적으로 나한테 더 간단하게 느껴져서 이 방법이 더 좋았다.

#### 라우팅 참고자료
- https://spoqa.github.io/2012/01/16/wsgi-and-flask.html
- https://mooneegee.blogspot.com/2017/10/python-flask-routing.html


## Connection to the Database
- `flask_sqlalchemy`에서 `SQLAlchemy` 클래스를 import하여 Flask application에 연결하는데 사용하며 SQLAlchemy 사용을 시작한다.
- `db = SQLAlchemy(app)`로 설정하는데 우리의 Flask application인 `app`을 넣어준다. 
- This would link an instance of a database that we can interact with in SQLAlchemy land to our Flask app.
- 데이터베이스와 상호작용 하기전에 먼저 해야될 것은 Flask application에서 우리의 데이터베이스에 연결하는 것이다. ==> setting a configuration variable on out application. 
- Flask의 모든 configuration variables는 딕셔너리 app.config에 있다.
- Flask-SQLAlchemy가 이해할 수 있는 방식으로 URI를 작성해주어야 한다.

#### Database Connection URI Parts
'postgresql://myusername:mypassword@localhost:5432/mydatabase'
